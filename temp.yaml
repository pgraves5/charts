---
# Source: objectscale-portal/charts/objectscale-graphql/charts/helm-controller/templates/controller-rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: install-controller
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-operator
    app.kubernetes.io/part-of: objs
    helm.sh/chart: helm-controller-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/objecscale-api-rbac.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: objectscale-api
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
---
# Source: objectscale-portal/charts/rsyslog-client/templates/cleanup-logs.yaml
#
# Copyright © [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

apiVersion: v1
kind: ConfigMap
metadata:
  name: objs-rsyslog-client-cleanup-logs-script
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
data:
  cleanup_logs.sh: |+
    #!/bin/bash

    # get customized watermarks from env file if provided
    if [[ -f /etc/pod.env ]];then
        source /etc/pod.env
    fi

    MONITORING_LOGS="/var/log"
    # only remove compressed log files for now
    LOG_FILE_PATTERN="*.log*.gz" # the index/timestamp could be before or after the .log infix
    CHECK_INTERVAL=10
    LOG_LIST_FILE=/tmp/log_list
    du_high_watermark="${LOGS_SIZE_HIGH_WATERMARK:-204800}"
    du_low_watermark="${LOGS_SIZE_LOW_WATERMARK:-153600}"

    _log() {
        msg="$*"
        if [[ -n "$msg" ]] ; then
            echo "$(date "+%m%d%Y %T")":  "$msg"
        fi
    }

    _walkrm() {
        # remove one by one
        local success=0
        i=0
        while read -r file; do
            rm -f "$file"
            _log "Removed $file"

            # check du less frequently to speed up removal
            i=$(( i + 1 ))
            if [[ $(( i % CHECK_INTERVAL)) -eq 0 ]]; then
                usage="$(du -skL ${MONITORING_LOGS} | cut -f1)"
                _log "Disk usage: ${usage}"
                if [[ "${usage}" -le "${du_low_watermark}" ]]; then
                    _log "Disk usage ${usage} is below low watermark ${du_low_watermark}"
                    success=1
                    break
                fi
            fi
        done < ${LOG_LIST_FILE}
        rm -f ${LOG_LIST_FILE}
        return $success
    }

    _log "Started cleanup script. Logs folder: ${MONITORING_LOGS}"

    test -d "${MONITORING_LOGS}"            || exit 3

    # check if another instance is running (slowly) already
    SELF=$(basename "$0")
    if pidof -o %PPID -x "$SELF" > /dev/null; then
        exit 4
    fi

    while getopts m: flag
    do
        case "${flag}" in
            m) run_mode=${OPTARG};;
        esac
    done

    configure_logrotate=false
    if [[ "$run_mode" == "server" ]]; then
        configure_logrotate=true
    fi

    fs_size_kb=$(df --output=size ${MONITORING_LOGS} | grep -v '1K-blocks')
    fs_size=$(( $fs_size_kb * 1024 ))

    if $configure_logrotate; then
        # TODO: add alert on script failure
        _log "Run /etc/logrotate_autoconf.py script"
        python3 /etc/logrotate_autoconf.py -s ${fs_size} -c /etc/svc_logs_priority_conf.json -w ${du_high_watermark} >> "${MONITORING_LOGS}/logrotate_autoconf.log" 2>&1
    fi

    _log "Run /etc/run_logrotate.sh script with redirecting to /var/log/logrotate.log"
    /etc/run_logrotate.sh >> /var/log/logrotate.log 2>&1


    # some log files might not get compressed in error conditions,
    # compress them if not modified for a day.
    # assume the file name will be like
    #     messages-20140825-1409004745
    #     rm.log.20140826-165818
    NOT_COMPRESSED_PATTERN=".*20[0-9]{6}-[0-9]{6,10}$"
    find -L "${MONITORING_LOGS}" -regextype posix-egrep -regex "${NOT_COMPRESSED_PATTERN}" \
        -mmin +60 -exec gzip -f {} +

    LOGS_DISK_USAGE=$(du -skL "${MONITORING_LOGS}" | cut -f1)
    _log "Disk usage: $LOGS_DISK_USAGE. High watermark: ${du_high_watermark}."

    if [[ "$LOGS_DISK_USAGE" -gt ${du_high_watermark} ]]; then
        # TODO: alert if this part is executed
        _log "Perform cleanup"

        # list files in time order
        find -L "${MONITORING_LOGS}" \( -name "${LOG_FILE_PATTERN}" \) \
            -exec stat -c "%Y %n" {} + | sort -n | awk '{print $2}' > ${LOG_LIST_FILE}
        _log "Remove .gz files"
        _walkrm
        success=$?

        # if no success after gz files cleanup then we have case when log rotation doesn't work for some reason
        # and most probably that each svc log become a single big .log file, to prevent disk space over usage
        # try to remove bigest logs one by one
        # TODO: we should alert here!
        if [[ $success -eq 0 ]]; then
            # now remove non compressed log files
            LOG_FILE_PATTERN="*.log.*"
            # list files by descending size order
            find -L "${MONITORING_LOGS}" \( -name "${LOG_FILE_PATTERN}" \) \
                -exec stat -c "%s %n" {} + | sort -nr | awk '{print $2}' > ${LOG_LIST_FILE}
            # as deletion will be by size then space will be freed faster so reduce check interval
            CHECK_INTERVAL=2
            _log "Remove .log files"
            _walkrm
        fi
    fi
    _log "Finished cleanup script"
---
# Source: objectscale-portal/charts/rsyslog-client/templates/cron-config.yaml
#
# Copyright © [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

apiVersion: v1
kind: ConfigMap
metadata:
  name: objs-rsyslog-client-cron-config
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
data:
  cron_logrotate: |+
    * * * * *      root    /etc/cleanup_logs.sh >> /var/log/cleanup_logs.log 2>&1
---
# Source: objectscale-portal/charts/rsyslog-client/templates/fluent-bit-client-config.yaml
#
# Copyright © [2021] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

apiVersion: v1
kind: ConfigMap
metadata:
  name: objs-fluent-bit-client-config
  # namespace is required for resources created by objectscale-vsphere
  namespace: test
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
data:
  fluent-bit.conf: |+
    [SERVICE]
        Flush         1
        Log_Level     info
        Daemon        off
        Parsers_File  parsers.conf

    @INCLUDE input-file.conf
    @INCLUDE filters.conf
    @INCLUDE output-syslog.conf
  parsers.conf: |+
    [PARSER]
        # Parse log file name from path, excluding rotation suffix,
        # e.g. /var/log/file.log.1 -> file.log
        Name   log_name
        Format regex
        Regex  ^(.*)\/(?<data_log_name>[^/]*)(?<data_log_suffix>\.log)(.[\d])?$
    [PARSER]
        # For vSphere stdout logs, parse container name from path and save it as log name
        # /var/log/pods/container_name/0/0.log -> container_name
        Name   stdout_container_log_name
        Format regex
        Regex  ^(.*)/(?<data_log_name>[^/]*)/\d+/\d+.log$
    [PARSER]
        Name          multiline
        Format        regex
        Regex         /(?<log>^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2},\d{3}\s\[[^\[]*\]\s\w+\s.*)/
        Reserve_Data  On
        # Lines not recognized as 'multiline' are saved to 'log' field
        Key           log
  input-file.conf: |+
    [INPUT]
        Name              tail
        Path              /var/log/*.log
        Refresh_Interval  5
        DB                /var/fluent-bit-state/fluentbit-file.db
        Read_from_Head    True
        Path_Key          path
        Tag               file
  input-stdout.conf: |+
    [INPUT]
        # Tail stdout logs for vSphere
        # CONTAINER_DIRS env var is populated with list of
        # /var/log/pod/<pod_id>/<container_name>/*/0.log logs
        Name              tail
        Path              ${CONTAINER_DIRS}
        Refresh_Interval  5
        DB                /var/fluent-bit-state/fluentbit-stdout.db
        Read_from_Head    True
        Path_Key          path
        Tag               stdout
  filters.conf: |+
    [FILTER]
        # Add metadata to fields with common prefix 'data_'
        Name   record_modifier
        Match  *
        Record data_pod_name ${POD_NAME}
        Record data_namespace_name ${POD_NAMESPACE}
        Record data_release_name ${POD_RELEASE}
        Record facility 22
    [FILTER]
        Name   record_modifier
        Match  stdout
        Record data_log_suffix ".stdout.log"
    [FILTER]
        Name         parser
        Match        file
        Key_Name     path
        Parser       log_name
        Reserve_Data True
    [FILTER]
        Name         parser
        Match        stdout
        Key_Name     path
        Parser       stdout_container_log_name
        Reserve_Data True
    [FILTER]
        # Nest all 'data_' fields under 'data' field to pass to syslog output
        Name          nest
        Match         *
        Operation     nest
        Wildcard      data_*
        Nest_under    data
        Remove_prefix data_
  output-syslog.conf: |+
    [OUTPUT]
       name                 syslog
       match                *
       host                 ${RSYSLOG_POD_ADDRESS}.svc.cluster.local
       mode                 tcp
       port                 10514
       syslog_maxsize       8192
       syslog_message_key   log
       syslog_sd_key        data
       syslog_appname_key   programname
       syslog_facility_key  facility
       # syslog output inserts BOM symbol before the message by default,
       # but rsyslog saves the BOM as is in output.
       # custom setting 'syslog_insert_bom' disables it
       syslog_insert_bom    false
       syslog_delimiter     10
---
# Source: objectscale-portal/charts/rsyslog-client/templates/logrotate-config.yaml
#
# Copyright © [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

apiVersion: v1
kind: ConfigMap
metadata:
  name: objs-rsyslog-client-logrotate-config
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
data:
  svc: |+
    /var/log/*.log
    {
      missingok
      copytruncate
      nocreate
      nosharedscripts
      size=10M
      maxage 14
      rotate 10
      notifempty
      compress
      dateext
      dateformat .%Y%m%d-%H%M%S
    }
  logrotate.conf: |+
    # see "man logrotate" for details
    # rotate log files daily
    daily

    # keep rotated logs for 14 days max
    maxage 14

    # rotate 10 by default
    rotate 10

    # use date as a suffix of the rotated file
    dateext

    # Add a dateformat
    dateformat .%Y%m%d-%H%M%S

    # max size is 5 MB
    size 5M

    # Compress log files
    compress

    # comment these to switch compression to use gzip or another
    # compression scheme
    compresscmd /usr/bin/gzip
    uncompresscmd /usr/bin/gunzip

    # rotate logs as root
    su root root

    # RPM packages drop log rotation information into this directory
    include /etc/logrotate.d
---
# Source: objectscale-portal/charts/rsyslog-client/templates/rsyslog-client-config.yaml
#
# Copyright © [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#

apiVersion: v1
kind: ConfigMap
metadata:
  name: objs-rsyslog-client-config
  # namespace is required for resources created by objectscale-vsphere
  namespace: test
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
data:
  rsyslog.conf.template: |+
    #### MODULES ####

    # input module: file
    # inotify mode doesn't work properly in kubernetes pods and
    # loose part of logs when they're rotated so "polling" used(OBSDEF-7562)
    module(load="imfile" mode="polling" pollinginterval="2")

    #### GLOBAL DIRECTIVES ####

    #### RULES ####

    # input log files
    input(type="imfile"
          File="/var/log/*.log"
          Tag="file"
          addMetadata="on"
          Ruleset="handle_multiple_logs"
          Facility="local0"
    )

    _STDOUT_CONF_

    ruleset(name="handle_multiple_logs") {
      # http://www.rsyslog.com/doc/v8-stable/rainerscript/functions.html
      # re_extract(expr, re, match, submatch, no-found)
      set $.suffix=re_extract($!metadata!filename, "(.*)/([^/]*)", 0, 2, "all.log");
      set $.pod_name=getenv("POD_NAME");
      call sendToLogserver
    }

    ruleset(name="handle_stdout_logs") {
      # http://www.rsyslog.com/doc/v8-stable/rainerscript/functions.html
      # re_extract(expr, re, match, submatch, no-found)
      set $.container_name=re_extract($!metadata!filename, "(.*)/([^/]*)/([^/]*)", 0, 2, "unknown_container");
      set $.log_name=re_extract($!metadata!filename, "(.*)/([^/]*)", 0, 2, "all.log");
      set $.suffix= $.container_name & ".stdout." & "log";
      set $.pod_name=getenv("POD_NAME");
      call sendToLogserver
    }

    # output template
    # customized RSYSLOG_SyslogProtocol23Format implementing RFC5424 format with custom structured data block
    template(name="OutputFormat" type="string"
             string="<%PRI%>1 %TIMESTAMP:::date-rfc3339% %HOSTNAME% %.pod_release%__%$.pod_name%__%$.suffix% %PROCID% %MSGID% [kubernetes namespace_name=\"%.pod_namespace%\"]%msg:::sp-if-no-1st-sp%%msg:::drop-last-lf%\n")

    ruleset(name="sendToLogserver") {
      set $.pod_namespace=getenv("POD_NAMESPACE");
      set $.pod_release=getenv("POD_RELEASE");
      action(type="omfwd"
          Target="_RSYSLOG_POD_ADDRESS_.svc.cluster.local"
          Port="10514"
          Protocol="tcp"
          Template="OutputFormat" )
    #    action.resumeRetryCount=100
    #    queue.type=linkedList queue.size=10000)
    }
  rsyslog_stdout.conf.template: |+
    input(type="imfile"
          # tail 0.log: vSphere rotates 0.log to 1.log, 2.log, etc.
          File="_CONTAINER_DIR_/[0-9]*/0.log"
          Tag="stdout"
          addMetadata="on"
          Ruleset="handle_stdout_logs"
          Facility="local0"
    )
---
# Source: objectscale-portal/templates/objectscale-portal-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: objectscale-portal
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.83.0-1329
    app.kubernetes.io/component: objectscale-portal
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-portal-0.83.0-1329
    release: objs
    operator: objectscale-operator
    product: objectscale
data:
  upstream.conf: |
    upstream graphql {
        server objectscale-graphql:8080;
    }
  nginx.conf: |
    events {
        worker_connections  4096;  ## Default: 1024
    }

    http {
        proxy_cache_path  /var/cache/nginx/grafana_auth_cache/ keys_zone=grafana_auth_cache:1m inactive=15m;

        include /etc/nginx/mime.types;
        include /conf/upstream.conf;
        map $request_method $decksname {
         default decks-support-store.test.svc.cluster.local;
        }
        map $request_method $decksport {
         default 7443;
        }

        map $request_method $fedsvcname {
         default objectscale-federation.test.svc.cluster.local;
        }
        map $request_method $fedsvcport {
         default 9500;
        }

        # map to support authorized but not added into grafana users (they will be logged as 'root')
        map $grafana_user $grafana_user_updated {
         "emcmonitor" "emcmonitor";
         "emcservice" "emcservice";
         default      "root";
        }

        server {
            resolver dns-default.openshift-dns.svc.cluster.local;
            listen       4443;
            server_name  localhost;
            access_log /dev/stdout;
            error_log /dev/stdout;
            rewrite_log on;
            ssl on;
            ssl_protocols        TLSv1.2;
            ssl_ciphers          AES:!ADH;
            ssl_certificate /etc/nginx/ssl/tls.crt;
            ssl_certificate_key /etc/nginx/ssl/tls.key;
            location /graphql {
                proxy_pass http://graphql;
            }
            location /data {
                proxy_pass https://$decksname:$decksport;
            }

            location ~* /grafana/[a-z0-9]([-a-z0-9]*[a-z0-9])?/[a-z0-9]([-a-z0-9]*[a-z0-9])?/logout_grafana {
                # grafana redirects to this endpoint after logout

                # subrequest for token invalidation
                # auth response 200: user was logged out
                # auth response 401: token is already invalid
                auth_request /invalidate_token_for_grafana;
                error_page 401 @logout_grafana;
                # workaround to redirect to @logout_grafana after response 200
                try_files false @logout_grafana;
            }

            location ~* /grafana/[a-z0-9]([-a-z0-9]*[a-z0-9])?/[a-z0-9]([-a-z0-9]*[a-z0-9])? {
                rewrite /grafana/([a-z0-9-]+)/([a-z0-9-]+)/(.*) /$3 break;
                rewrite /grafana/([a-z0-9-]+)/([a-z0-9-]+) / break;

                # do auth request
                auth_request /validate_token_for_grafana;
                error_page 401 @grafana_auth_err;
                # after auth request take user name from header X-SDS-AUTH-USERNAME
                auth_request_set $grafana_user $upstream_http_x_sds_auth_username;
                # set header which is required for grafana access
                # value comes from $grafana_user variable thru the map defined at the top
                proxy_set_header X-WEBAUTH-USER $grafana_user_updated;
                # clear header which is used for basic auth
                proxy_set_header Authorization "";
                proxy_pass http://$2-grafana.$1.svc.cluster.local:3000;
            }

            location @grafana_auth_err {
                absolute_redirect off;
                return 302 /?action=logoff;
            }

            location /validate_token_for_grafana {
                internal;
                # override global setting
                proxy_buffering on;
                proxy_cache grafana_auth_cache;
                proxy_cache_key "$cookie_osauthtoken";
                # for now we set expiration time to 5m, later may be changed to use value from authsvc response header
                proxy_cache_valid 5m;
                # cut all redundant headers excluding those which are set in this location
                proxy_pass_request_headers off;
                proxy_pass_request_body off;
                # take token value from cookie with name OSAuthToken and set it as header
                proxy_set_header X-SDS-AUTH-TOKEN $cookie_osauthtoken;
                proxy_set_header X-ALLOW-ROLES "SYSTEM_ADMIN,SYSTEM_MONITOR";
                proxy_set_header Content-Length "";
                proxy_pass http://$fedsvcname:$fedsvcport/mgmt/validateToken;
            }

            location /invalidate_token_for_grafana {
                internal;
                # override global setting
                proxy_buffering on;
                # cut all redundant headers excluding those which are set in this location
                proxy_pass_request_headers off;
                proxy_pass_request_body off;
                # take token value from cookie with name OSAuthToken and set it as header
                proxy_set_header X-SDS-AUTH-TOKEN $cookie_osauthtoken;
                proxy_set_header Content-Length "";
                proxy_pass http://$fedsvcname:$fedsvcport/mgmt/logout;
            }

            location @logout_grafana {
                absolute_redirect off;

                # cleanup auth token
                add_header Set-Cookie "OSAuthToken=; Path=/; secure; Secure; HTTPOnly";
                return 302 /?action=logoff;
            }

            location /platform {
                default_type application/json;
                return 200 '{"value":"OpenShift"}';
            }
            location /features {
                return 200 '{"manageObjectStoreV2":true,"objectscaleSystems":true,"replications":true,"uiLoggingLevel":"ERROR"}';
            }
            location / {
                add_header X-Frame-Options "SAMEORIGIN";
                root   /usr/share/nginx/html;
                index  index.html index.htm;
            }
        }
    }
  plugin.json: |
    {
        "manifestVersion": "1.0.0",
        "requirements": {
            "plugin.api.version": "1.0.0"
        },
        "configuration": {
            "nameKey": "plugin.name",
            "icon": {
                "name": "star"
            },
        },
        "objects": {
            "ClusterComputeResource": {
                "summary": {
                    "view": {
                        "uri": "index.html?view=summary",
                        "size": {
                            "widthSpan": 1,
                            "heightSpan": 2
                        }
                    }
                },
                "monitor": {
                    "views": [
                        {
                            "navigationId": "deos.monitor.health",
                            "labelKey": "cluster.monitor.list.health",
                            "uri": "index.html?view=health"
                        }
                    ]
                },
                "configure": {
                    "views": [
                        {
                            "navigationId": "deos.configure.dashboard",
                            "labelKey": "cluster.configure.list.dashboard",
                            "uri": "index.html?view=dashboard"
                        },
                        {
                            "navigationId": "deos.configure.accounts",
                            "labelKey": "cluster.configure.list.accounts",
                            "uri": "index.html?view=accounts"
                        },
                        {
                            "navigationId": "deos.configure.objectstores",
                            "labelKey": "cluster.configure.list.objectstores",
                            "uri": "index.html?view=objectstores"
                        },
                        {
                            "navigationId": "deos.configure.objectscalesystems",
                            "labelKey": "cluster.configure.list.objectscalesystems",
                            "uri": "index.html?view=objectscalesystems"
                        },
                        
                        {
                            "navigationId": "deos.configure.settings",
                            "labelKey": "cluster.configure.list.settings",
                            "uri": "index.html?view=settings"
                        }
                    ]
                }
            }
        },
        "definitions": {
            "iconSpriteSheet": {
                "uri": "assets/images/sprites.png",
                "definitions": {
                    "star": {
                        "x": 0,
                        "y": 96
                    }
                }
            },
            "i18n": {
                "locales": [
                    "en-US",
                    "de-DE",
                    "fr-FR"
                ],
                "definitions": {
                    "plugin.name": {
                        "en-US": "ObjectScaleSERVICE_ID",
                        "de-DE": "ObjectScaleSERVICE_ID",
                        "fr-FR": "ObjectScaleSERVICE_ID"
                    },
                    "cluster.monitor.list.health": {
                        "en-US": "HealthSERVICE_ID",
                        "de-DE": "GesundheitSERVICE_ID",
                        "fr-FR": "santéSERVICE_ID"
                    },
                    "cluster.configure.list.objectstores": {
                        "en-US": "Object StoresSERVICE_ID",
                        "de-DE": "Object StoresSERVICE_ID",
                        "fr-FR": "Object StoresSERVICE_ID"
                    },
                    "cluster.configure.list.settings": {
                        "en-US": "SettingsSERVICE_ID",
                        "de-DE": "SettingsSERVICE_ID",
                        "fr-FR": "SettingsSERVICE_ID"
                    },
                    "cluster.configure.list.dashboard": {
                        "en-US": "DashboardSERVICE_ID",
                        "de-DE": "DashboardSERVICE_ID",
                        "fr-FR": "DashboardSERVICE_ID"
                    },
                    "cluster.configure.list.accounts": {
                        "en-US": "AccountsSERVICE_ID",
                        "de-DE": "AccountsSERVICE_ID",
                        "fr-FR": "AccountsSERVICE_ID"
                    },
                    "cluster.configure.list.objectscalesystems": {
                        "en-US": "Objectscale SystemsSERVICE_ID",
                        "de-DE": "Objectscale SystemsSERVICE_ID",
                        "fr-FR": "Objectscale SystemsSERVICE_ID"
                    }
                }
            }
        }
    }
---
# Source: objectscale-portal/charts/objectscale-graphql/charts/helm-controller/templates/controller-rbac.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-install-controller
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-operator
    app.kubernetes.io/part-of: objs
    helm.sh/chart: helm-controller-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
rules:
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - roles
      - rolebindings
      - clusterroles
      - clusterrolebindings
    verbs:
      - '*'
  - apiGroups:
      - ecs.dellemc.com
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - decks.ecs.dellemc.com
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - kahm.emcecs.github.com
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - storage.k8s.io
    resources:
      - storageclasses
      - storageclasslists
    verbs:
      - get
      - list
  - apiGroups:
      - ""
    resources:
      - pods
      - services
      - endpoints
      - persistentvolumeclaims
      - persistentvolumes
      - events
      - configmaps
      - secrets
      - serviceaccounts
    verbs:
      - "*"
  - apiGroups:
      - batch
    resources:
      - jobs
      - cronjobs
    verbs:
      - "*"
  - apiGroups:
      - certificates.k8s.io
    resources:
      - certificatesigningrequests
    verbs:
      - "*"
  - apiGroups:
      - certificates.k8s.io
    resources:
      - certificatesigningrequests/approval
    verbs:
      - update
  - apiGroups:
      - policy
    resources:
      - poddisruptionbudgets
    verbs:
      - "*"
  - apiGroups:
      - apps
    resources:
      - deployments
      - daemonsets
      - replicasets
      - statefulsets
    verbs:
      - "*"
  - apiGroups:
      - zookeeper.pravega.io
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - app.k8s.io
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - atlas.dellemc.com
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - influxdata.com
    resources:
      - influxdbs
    verbs:
      - "*"
  - apiGroups:
      - ""
    resources:
      - nodes
      - clusterroles
    verbs:
      - "*"
  - apiGroups:
    - apiextensions.k8s.io
    resources:
    - customresourcedefinitions
    verbs:
    - '*'
  - apiGroups:
    - ""
    resources:
    - namespaces
    verbs:
    - list
    - get
  - apiGroups:
      - stateful.ecs.dellemc.com
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
    - "admissionregistration.k8s.io"
    resources:
    - "mutatingwebhookconfigurations"
    - "validatingwebhookconfigurations"
    verbs:
      - "*"
  - apiGroups:
      - db.ecs.dellemc.com
    resources:
      - "*"
    verbs:
      - "*"
  - apiGroups:
      - networking.k8s.io
    resources:
      - networkpolicies
    verbs:
      - '*'
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/object-store-admin-role.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-object-store-admin
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
rules:
- apiGroups:
  - ecs.dellemc.com
  resources:
  - ecsclusters
  verbs:
  - "*"
- apiGroups:
  - app.k8s.io
  resources:
  - "*"
  verbs:
  - "*"
- apiGroups:
  - influxdata.com
  resources:
  - influxdbs
  verbs:
  - "*"
- apiGroups:
    - ""
  resources:
    - pods
    - persistentvolumeclaims
    - secrets
    - configmaps
  verbs:
    - "*"
- apiGroups:
    - batch
  resources:
    - jobs
    - cronjobs
  verbs:
    - "*"
- apiGroups:
    - appplatform.wcp.vmware.com
  resources:
    - storagepolicies
  verbs:
    - get
    - list
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - rolebindings
  verbs:
  - get
  - list
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/object-store-monitor-role.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-object-store-monitor
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
    rbac.authorization.k8s.io/aggregate-to-edit: "true"
    rbac.authorization.k8s.io/aggregate-to-view: "true"
    rbac.authorization.k8s.io/aggregate-to-admin: "true"
rules:
- apiGroups:
  - ecs.dellemc.com
  resources:
  - ecsclusters
  verbs:
  - get
  - list
  - watch
- apiGroups:
    - ecs.dellemc.com
  resources:
    - networkconnections
  verbs:
    - get
    - watch
    - list
- apiGroups:
  - ""
  resources:
  - pods
  - services
  - endpoints
  - persistentvolumeclaims
  - persistentvolumes
  - events
  - configmaps
  - secrets
  - resourcequotas
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - batch
  resources:
  - jobs
  - cronjobs
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - policy
  resources:
  - poddisruptionbudgets
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - apps
  resources:
  - deployments
  - daemonsets
  - replicasets
  - statefulsets
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - zookeeper.pravega.io
  resources:
  - "*"
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - app.k8s.io
  resources:
  - "*"
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - atlas.dellemc.com
  resources:
  - "*"
  verbs:
  - get
  - watch
  - list
- apiGroups:
  - influxdata.com
  resources:
  - influxdbs
  verbs:
  - "*"
- apiGroups:
    - metrics.k8s.io
  resources:
    - "*"
  verbs:
    - get
    - watch
    - list
- apiGroups:
    - appplatform.wcp.vmware.com
  resources:
    - storagepolicies
  verbs:
    - get
    - list
- apiGroups:
    - appplatform.wcp.vmware.com
  resources:
    - storagepolicies
  verbs:
    - get
    - list
- apiGroups:
  - rbac.authorization.k8s.io
  resources:
  - rolebindings
  verbs:
  - get
  - list
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/objectscale-admin-cluster-role.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-objectscale-admin
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: graphql-cluster-scoped-resources
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
rules:
  - apiGroups:
      - cns.vmware.com
    resources:
      - storagepools
    verbs:
      - get
      - list
  - apiGroups:
      - csi-baremetal.dell.com
    resources:
      - availablecapacities
    verbs:
      - get
      - list
  - apiGroups:
      - storage.k8s.io
    resources:
      - storageclasses
      - storageclasslists
    verbs:
      - get
      - list
  - apiGroups:
      - certificates.k8s.io
    resources:
      - certificatesigningrequests
    verbs:
      - "*"
  - apiGroups:
      - certificates.k8s.io
    resources:
      - certificatesigningrequests/approval
    verbs:
      - update
  - apiGroups:
      - certificates.k8s.io
    resourceNames:
      - kubernetes.io/*
    resources:
      - signers
    verbs:
      - approve
  - apiGroups:
      - rbac.authorization.k8s.io
    resources:
      - clusterroles
      - clusterrolebindings
    verbs:
      - "*"
  - apiGroups:
      - ""
    resources:
      - nodes
      - clusterroles
    verbs:
      - "*"
  - apiGroups:
      - ""
    resources:
      - pods
      - namespaces
      - serviceaccounts
      - resourcequotas
      - configmaps
    verbs:
      - get
      - list
      - watch
  - apiGroups:
    - ""
    resources:
      - secrets
    verbs:
      - get
      - list
      - watch
      - create
---
# Source: objectscale-portal/charts/objectscale-graphql/charts/helm-controller/templates/controller-rbac.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-install-controller
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: helm-controller
    app.kubernetes.io/part-of: objs
    helm.sh/chart: helm-controller-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
subjects:
  - kind: ServiceAccount
    name: install-controller
    namespace: test
roleRef:
  kind: ClusterRole
  name: test-install-controller
  apiGroup: rbac.authorization.k8s.io
---
# Source: objectscale-portal/templates/objectscale-api-role-bindings.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-objectscale-api-as-admin
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.83.0-1329
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-portal-0.83.0-1329
    release: objs
    operator: objectscale-operator
    product: objectscale
subjects:
  - kind: ServiceAccount
    name: objectscale-api
    namespace: test
roleRef:
  kind: ClusterRole
  name: test-objectscale-admin
  apiGroup: rbac.authorization.k8s.io
---
# Source: objectscale-portal/templates/openshift-scc.yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: objs-test-scc-anyuid
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: system:openshift:scc:anyuid
subjects:
- apiGroup: rbac.authorization.k8s.io
  kind: Group
  name: system:serviceaccounts
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/objecscale-api-rbac.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-objectscale-api
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
rules:
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
    - "*"
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/objectscale-admin-role.yaml
kind: Role
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-objectscale-admin
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
rules:
- apiGroups:
    - decks.ecs.dellemc.com
  resources:
    - "*"
  verbs:
    - "*"
- apiGroups:
    - ecs.dellemc.com
  resources:
    - "*"
  verbs:
    - "*"
- apiGroups:
    - kahm.emcecs.github.com
  resources:
    - "*"
  verbs:
    - "*"
- apiGroups:
    - ""
  resources:
    - secrets
    - pods
    - services
    - endpoints
    - persistentvolumeclaims
    - persistentvolumes
    - events
    - configmaps
  verbs:
    - "*"
- apiGroups:
    - batch
  resources:
    - jobs
    - cronjobs
  verbs:
    - "*"
- apiGroups:
    - policy
  resources:
    - poddisruptionbudgets
  verbs:
    - get
    - list
    - watch
- apiGroups:
    - apps
  resources:
    - deployments
    - daemonsets
    - replicasets
    - statefulsets
  verbs:
    - "*"
- apiGroups:
    - app.k8s.io
  resources:
    - "*"
  verbs:
    - "*"
- apiGroups:
    - metrics.k8s.io
  resources:
    - "*"
  verbs:
    - get
    - watch
    - list
- apiGroups:
    - appplatform.wcp.vmware.com
  resources:
    - storagepolicies
  verbs:
    - get
    - list
---
# Source: objectscale-portal/charts/rsyslog-client/templates/rbac_role.yaml
#
# Copyright © [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#
#  Role for rsyslog-client to find instance of rsyslog service
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
  name: "objs-rsyslog-client"
  namespace: "test"
rules:
  - apiGroups: [""]
    resources: ["pods"]
    verbs: ["list"]
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/objecscale-api-rbac.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-objectscale-api
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
subjects:
- kind: ServiceAccount
  name: objectscale-api
  namespace: test
roleRef:
  kind: Role
  name: test-objectscale-api
  apiGroup: rbac.authorization.k8s.io
---
# Source: objectscale-portal/charts/rsyslog-client/templates/rbac_rolebinding.yaml
#
# Copyright © [2020] Dell Inc. or its subsidiaries.
# All Rights Reserved.
#
# This software contains the intellectual property of Dell Inc.
# or is licensed to Dell Inc. from third parties. Use of this
# software and the intellectual property contained therein is expressly
# limited to the terms and conditions of the License Agreement under which
# it is provided by or on behalf of Dell Inc. or its subsidiaries.
#
#
#  RoleBinding for rsyslog-client to find instance of rsyslog service
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: "objs-rsyslog-client"
  namespace: "test"
  labels:
    app.kubernetes.io/name: objs-rsyslog-client
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: "0.54.0"
    app.kubernetes.io/part-of: objs
    helm.sh/chart: rsyslog-client-3.7.0-1310.73bafb3b
    release: objs
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: Group
    name: system:serviceaccounts
roleRef:
  kind: Role
  apiGroup: rbac.authorization.k8s.io
  name: "objs-rsyslog-client"
---
# Source: objectscale-portal/templates/objectscale-api-role-bindings.yaml
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: test-objectscale-api-as-admin
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.83.0-1329
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-portal-0.83.0-1329
    release: objs
    operator: objectscale-operator
    product: objectscale
subjects:
  - kind: ServiceAccount
    name: objectscale-api
    namespace: test
roleRef:
  kind: Role
  name: test-objectscale-admin
  apiGroup: rbac.authorization.k8s.io
---
# Source: objectscale-portal/charts/objectscale-graphql/charts/helm-controller/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: objs-installer
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/component: objectscale-install-controller
    helm.sh/chart: helm-controller-0.82.0
    app.kubernetes.io/instance: objs
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/part-of: objs
    release: objs
    operator: objectscale-operator
    product: objectscale
    io.kompose.service: helm-controller
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 80
      targetPort: 8080
  selector:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/component: objectscale-install-controller
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/graphql-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: objectscale-graphql
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/component: objectscale-graphql
  ports:
    - port: 8080
      name: http
---
# Source: objectscale-portal/templates/objectscale-portal-service.yaml
---
apiVersion: v1
kind: Service
metadata:
  name: objectscale-portal-external
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.83.0-1329
    app.kubernetes.io/component: objectscale-portal
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-portal-0.83.0-1329
    release: objs
    operator: objectscale-operator
    product: objectscale
spec:
  type: LoadBalancer
  selector:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/component: objectscale-portal
  ports: 
      - name: https
        port: 4443
        targetPort: 4443
---
# Source: objectscale-portal/charts/objectscale-graphql/charts/helm-controller/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: objectscale-install-controller
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/component: objectscale-install-controller
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/instance: objs
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/part-of: objs
    helm.sh/chart: helm-controller-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: objectscale-manager
      app.kubernetes.io/component: objectscale-install-controller
  template:
    metadata:
      labels:
        app.kubernetes.io/name: objectscale-manager
        app.kubernetes.io/component: objectscale-install-controller
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/instance: objs
        app.kubernetes.io/version: 0.82.0
        app.kubernetes.io/part-of: objs
        helm.sh/chart: helm-controller-0.82.0
        release: objs
        operator: objectscale-operator
        product: objectscale
        objectscale.dellemc.com/sp-integrated: "true"
      annotations:
        appplatform.vmware.com/vsphere-emm-integrated: "true"
    spec:
      serviceAccountName: install-controller
      containers:
        - name: objectscale-install-controller
          resources:
            limits:
              memory: 500M
            requests:
              memory: 250M
          image: asdrepo.isus.emc.com:8099/install-controller:0.82.0
          env:
            - name: OPERATOR_NAME
              value: objectscale-operator
            - name: MY_POD_IP
              valueFrom:
                fieldRef:
                  fieldPath: status.podIP
            - name: REST_PORT
              value: "8080"
            - name: RELEASE_NAME
              value: objs
            - name: RELEASE_NAMESPACE
              value: test
            - name: WATCH_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 8080
              name: http
---
# Source: objectscale-portal/charts/objectscale-graphql/templates/graphql-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: objectscale-graphql
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.82.0
    app.kubernetes.io/component: objectscale-graphql
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-graphql-0.82.0
    release: objs
    operator: objectscale-operator
    product: objectscale
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: objectscale-manager
      app.kubernetes.io/component: objectscale-graphql
  template:
    metadata:
      labels:
        app.kubernetes.io/name: objectscale-manager
        app.kubernetes.io/component: objectscale-graphql
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/instance: objs
        app.kubernetes.io/part-of: objs
        app.kubernetes.io/version: 0.82.0
        helm.sh/chart: objectscale-graphql-0.82.0
        release: objs
        operator: objectscale-operator
        product: objectscale
        objectscale.dellemc.com/sp-integrated: "true"
      annotations:
        appplatform.vmware.com/vsphere-emm-integrated: "true"
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app.kubernetes.io/component: objectscale-graphql
                  app.kubernetes.io/name: objectscale-manager
              namespaces:
                - test
              topologyKey: kubernetes.io/hostname
      serviceAccountName: objectscale-api
      containers:
      - name: objectscale-graphql
        image: asdrepo.isus.emc.com:8099/ecs-flex-graphql:0.82.0-759.11b4ef6
        imagePullPolicy: IfNotPresent
        args:
        - --
        - -startapps
        env:
        - name: OBJSTORE_AVAILABLE_VERSIONS
          value: "[\"0.82.0\"]"
        - name: GRAPHQL_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: WATCH_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: EVENT_PAGINATION_SOURCE
          value: KAHM
        - name: GLOBAL_REGISTRY
          value: asdrepo.isus.emc.com:8099
        - name: LICENSE_CHART_VERSION
          value: 2.82.0
        - name: SUPPORTASSIST_CHART_VERSION
          value: 2.82.0
        - name: SRSGATEWAY_CHART_VERSION
          value: 1.2.0
        - name: OPERATOR_NAME
          value: objectscale-operator
        - name: MANAGER_RELEASE_NAME
          value: objectscale-manager
        - name: STORAGE_CLASS_NAME
          value: csi-baremetal-sc-ssdlvg
        - name: LOG_DIRECTION
          value: stdout
        - name: HELM_CONTROLLER_ENDPOINT
          value: http://objs-installer
        - name: KUBERNETES_PLATFORM
          value: OpenShift
        - name: RELEASE_NAME
          value: objs
        ## used for graplql app deployment
        - name: GLOBAL_VALUES
          value: "{\"objectscale_release_name\":\"objectscale-manager\",\"platform\":\"OpenShift\",\"registry\":\"asdrepo.isus.emc.com:8099\",\"rsyslog_enabled\":true,\"secondaryStorageClass\":\"csi-baremetal-sc-hddlvg\",\"storageClassName\":\"csi-baremetal-sc-ssdlvg\",\"watchAllNamespaces\":false}"
        - name: GLOBAL_SECONDARY_STORAGE_CLASS
          value: csi-baremetal-sc-hddlvg
      - name: rsyslog
        image: "asdrepo.isus.emc.com:8099/rsyslog:3.7.0.0-1310.73bafb3b"
        imagePullPolicy: "IfNotPresent"
        env:
          - name: POD_NAME
            valueFrom:
              fieldRef:
                fieldPath: metadata.name
          - name: POD_UID
            valueFrom:
              fieldRef:
                fieldPath: metadata.uid
          - name: POD_NAMESPACE
            value: "test"
          - name: POD_RELEASE
            value: "objs"
          - name: LOG_STDOUT_ENABLED
            value: "false"
          - name: NODE_NAME
            valueFrom:
              fieldRef:
                fieldPath: spec.nodeName
          - name: RSYSLOG_CLIENT
            value: "true"
          - name: RSYSLOG_SVC_NAME
            value: objectscale-manager-rsyslog
          - name: RSYSLOG_SVC_NAMESPACE
            value: test
        volumeMounts:
          - mountPath: /etc/rsyslog
            name: rsyslog-config
      volumes:
      
      - name: rsyslog-config
        configMap:
          name: objs-rsyslog-client-config
---
# Source: objectscale-portal/templates/objectscale-portal-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: objectscale-portal
  namespace: test
  labels:
    app.kubernetes.io/name: objectscale-manager
    app.kubernetes.io/instance: objs
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/version: 0.83.0-1329
    app.kubernetes.io/component: objectscale-portal
    app.kubernetes.io/part-of: objs
    helm.sh/chart: objectscale-portal-0.83.0-1329
    release: objs
    operator: objectscale-operator
    product: objectscale
spec:
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: objectscale-manager
      app.kubernetes.io/component: objectscale-portal
  template:
    metadata:
      labels:
        app.kubernetes.io/name: objectscale-manager
        app.kubernetes.io/component: objectscale-portal
        app.kubernetes.io/managed-by: Helm
        app.kubernetes.io/instance: objs
        app.kubernetes.io/part-of: objs
        app.kubernetes.io/version: 0.83.0-1329
        helm.sh/chart: objectscale-portal-0.83.0-1329
        release: objs
        operator: objectscale-operator
        product: objectscale
        objectscale.dellemc.com/sp-integrated: "true"
      annotations:
        appplatform.vmware.com/vsphere-emm-integrated: "true"
    spec:
      volumes:
        - name: config-volume
          configMap:
            name: objectscale-portal
        
        - name: rsyslog-config
          configMap:
            name: objs-rsyslog-client-config
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: objectscale-portal
                app.kubernetes.io/name: objectscale-manager
            namespaces:
            - test
            topologyKey: kubernetes.io/hostname
      containers:
        - name: objectscale-portal
          image: asdrepo.isus.emc.com:8099/ecs-flex-vsphere-plugin:0.82.0.0-1452.945728c51
          env:
            - name: OPERATOR_NAME
              value: objectscale-operator
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - name: config-volume
              mountPath: /usr/share/nginx/html/plugin.json
              subPath: plugin.json
            - name: config-volume
              mountPath: /conf/upstream.conf
              subPath: upstream.conf
            - name: config-volume
              mountPath: /etc/nginx/nginx.conf
              subPath: nginx.conf
        - name: rsyslog
          image: "asdrepo.isus.emc.com:8099/rsyslog:3.7.0.0-1310.73bafb3b"
          imagePullPolicy: "IfNotPresent"
          env:
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: POD_UID
              valueFrom:
                fieldRef:
                  fieldPath: metadata.uid
            - name: POD_NAMESPACE
              value: "test"
            - name: POD_RELEASE
              value: "objs"
            - name: LOG_STDOUT_ENABLED
              value: "false"
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: RSYSLOG_CLIENT
              value: "true"
            - name: RSYSLOG_SVC_NAME
              value: objectscale-manager-rsyslog
            - name: RSYSLOG_SVC_NAMESPACE
              value: test
          volumeMounts:
            - mountPath: /etc/rsyslog
              name: rsyslog-config
---
# Source: objectscale-portal/templates/objectscale-portal-pre-delete-hook.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: "objectscale-portal-pre-delete"
  namespace: test
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-5"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
---
# Source: objectscale-portal/templates/objectscale-portal-pre-delete-hook.yaml
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: "test-pre-delete"
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-4"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
rules:
  - apiGroups:
      - decks.ecs.dellemc.com
    resources:
      - licenses
      - supportassists
    verbs:
      - get
      - list
  - apiGroups:
      - ecs.dellemc.com
    resources:
      - ecsclusters
    verbs:
      - get
      - list
  - apiGroups:
      - app.k8s.io
    resources:
      - applications
    verbs:
      - get
      - list
      - delete
      - update
  - apiGroups:
      - ""
    resources:
      - secrets
    verbs:
      - get
      - watch
      - list
      - create
      - update
      - delete
---
# Source: objectscale-portal/templates/objectscale-portal-pre-delete-hook.yaml
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: "test-pre-delete"
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-3"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
subjects:
  - kind: ServiceAccount
    name: "objectscale-portal-pre-delete"
    namespace: test
roleRef:
  kind: ClusterRole
  name: "test-pre-delete"
  apiGroup: rbac.authorization.k8s.io
---
# Source: objectscale-portal/templates/objectscale-portal-pre-delete-hook.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: "test-objectscale-portal-pre-delete"
  namespace: test
  annotations:
    "helm.sh/hook": pre-delete
    "helm.sh/hook-weight": "-1"
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  backoffLimit: 3
  activeDeadlineSeconds: 300
  template:
    metadata:
      name: "test-objectscale-portal-pre-delete"
    spec:
      serviceAccountName: "objectscale-portal-pre-delete"
      restartPolicy: Never
      containers:
        - name: pre-delete-job
          imagePullPolicy: IfNotPresent
          image: "asdrepo.isus.emc.com:8099/ecs-flex-graphql:0.82.0-769.a415d196"
          args:
            - --
            - -deleteapps
